@inherits MvvmComponentBase<ScenarioOptionsViewModel>

<MDialog Value=@Bind(x => x.IsOpen)
         ValueChanged="@BindingContext.OnIsOpenChanged"
         Persistent
         MaxWidth=800>
    <MCard Dark>
        <MToolbar>
            <ChildContent>
                <MTextField Dark
                            @bind-Value="BindingContext.Repo"
                            HideDetails="true"
                            Label=@StringKeys.Scenario.Options.Repo
                            PrependInnerIcon="mdi-git"
                            Disabled="@BindingContext.IsRepoLoading"
                            Loading="@BindingContext.IsRepoLoading">
                    <ProgressContent>
                        <MProgressLinear Indeterminate="@BindingContext.IsRepoLoading"
                                         Absolute>
                        </MProgressLinear>
                    </ProgressContent>
                </MTextField>
                @if (!string.IsNullOrEmpty(BindingContext.Repo))
                {
                    <MButton Icon
                         Color="@(BindingContext.IsRepoLoading?"red":"")"
                         OnClick="@(async _ =>
                                  {
                                      if (BindingContext.IsRepoLoading)
                                      {
                                          BindingContext.CancleFetchBranches();
                                      }
                                      else
                                      {
                                          await BindingContext.FetchBranches();
                                      }
                                  })">
                        <MIcon Large>
                            @if (BindingContext.IsRepoLoading)
                            {
                                @("mdi-stop-circle-outline")
                            }
                            else
                            {
                                @("mdi-search-web")
                            }
                        </MIcon>
                    </MButton>
                }
            </ChildContent>
        </MToolbar>
        <MBanner SingleLine @bind-Value="@BindingContext.IsShowBranchList">
            <ChildContent>
                <MSelect Value="BindingContext.CurrentBranch"
                         ValueChanged="BindingContext.CloneBranch"
                         Dark
                         Dense
                         Items="BindingContext.Branches"
                         Label=@StringKeys.Scenario.Options.SelectBranch
                         ItemText="x => x"
                         ItemValue="x => x"
                         TItem="string"
                         TItemValue="string"
                         TValue="string"
                         HideDetails="true"
                         Loading="@BindingContext.IsBranchLoading"
                         PrependIcon="mdi-source-branch-sync">
                    <ProgressContent>
                        <MProgressLinear Indeterminate="@BindingContext.IsBranchLoading"
                                         Absolute>
                        </MProgressLinear>
                    </ProgressContent>
                </MSelect>
            </ChildContent>
        </MBanner>
        <MCardActions Class="justify-end">
            <MButton Text
                     OnClick="() => BindingContext.IsOpen = false">
                @StringKeys.Dialog.Button.Close
            </MButton>
        </MCardActions>
    </MCard>
</MDialog>